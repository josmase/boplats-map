name: Release Docker image

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  release-docker-image:
    strategy:
      matrix:
        service:
          [
            new-new-boplats-frontend,
            new-new-boplats-scraper,
            new-new-boplats-api,
          ]
        dockerfile-path:
          [
            ./apps/frontend/Dockerfile,
            ./apps/scraper/Dockerfile,
            ./apps/api/Dockerfile,
          ]

    uses: josmase/workflows/.github/workflows/docker-build-and-push.yaml@main
    with:
      runner: new-new-boplats
      registry_url: ${{ vars.REGISTRY_URL }}
      image_name: josmase/${{ matrix.service }}
      dockerfile: ${{ matrix.dockerfile-path }}
      context: .
    secrets:
      registry_username: ${{ secrets.REGISTRY_USERNAME }}
      registry_password: ${{ secrets.REGISTRY_PASSWORD }}
    permissions:
      contents: read
      attestations: write
